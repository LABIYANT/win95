<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RetroOS | Ultimate Professional Edition</title>
    <style>
        /* --- Sƒ∞STEM GENELƒ∞ --- */
        :root {
            --win-gray: #c0c0c0;
            --win-dark-gray: #808080;
            --win-blue: #000080;
            --win-text: #000;
            --desktop-bg: #008080;
        }

        * { box-sizing: border-box; user-select: none; }
        
        body {
            margin: 0; padding: 0;
            background-color: #000;
            font-family: 'Tahoma', sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        /* 3D Border Efektleri */
        .outset { border: 2px solid; border-color: #fff #000 #000 #fff; background: var(--win-gray); }
        .inset { border: 2px solid; border-color: #404040 #fff #fff #404040; background: #fff; }
        .btn-win { border: 2px outset #fff; background: var(--win-gray); cursor: pointer; display: inline-block; padding: 2px 5px; font-size: 11px;}
        .btn-win:active { border-style: inset; }

        /* --- BIOS BOOT EKRANI --- */
        #boot-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: black; color: #ccc; font-family: 'Courier New', monospace;
            padding: 40px; z-index: 99999;
            display: flex; flex-direction: column; gap: 10px;
        }
        .cursor { animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0; } }

        /* --- KAPANI≈û & BSOD --- */
        #shutdown-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 11000; pointer-events: none;
            opacity: 0; transition: opacity 2s;
            display: flex; align-items: center; justify-content: center; color: #fff; font-size: 20px; font-family: 'Courier New';
        }

        #bsod {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #0000AA; color: white; font-family: 'Courier New', monospace;
            padding: 50px; z-index: 100000; font-weight: bold;
        }

        /* --- MASA√úST√ú --- */
        #desktop {
            width: 100%; height: calc(100% - 34px);
            background-color: var(--desktop-bg);
            position: relative;
            display: none;
            background-size: cover;
            background-position: center;
        }

        /* --- SAƒû TIK MEN√úS√ú --- */
        #context-menu {
            display: none; position: absolute; z-index: 9500;
            width: 150px; background: var(--win-gray);
            border: 2px outset #fff; box-shadow: 2px 2px 5px rgba(0,0,0,0.5);
        }
        .ctx-item {
            padding: 5px 15px; font-size: 12px; cursor: pointer;
            border-bottom: 1px solid transparent; color: black;
        }
        .ctx-item:hover { background: var(--win-blue); color: white; }
        .ctx-divider { height: 1px; background: #888; margin: 2px 0; border-bottom: 1px solid #fff; }

        /* --- CRT EFEKT KATMANI --- */
        #crt-overlay {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none; z-index: 50000;
            opacity: 0; transition: opacity 0.5s;
        }
        .crt-on #crt-overlay { opacity: 1; }

        /* --- ƒ∞KONLAR --- */
        .desktop-icon {
            width: 80px; position: absolute;
            display: flex; flex-direction: column; align-items: center;
            color: white; cursor: pointer; text-align: center;
            border: 1px solid transparent; padding: 5px;
            z-index: 1;
        }
        .desktop-icon:hover { background: rgba(0,0,80,0.2); border: 1px dotted rgba(255,255,255,0.3); }
        .desktop-icon:active { border: 1px dotted white; background: rgba(0,0,80,0.5); }
        .desktop-icon .ico-img { 
            width: 32px; height: 32px; margin-bottom: 5px; font-size: 28px;
        }
        .desktop-icon span { font-size: 11px; text-shadow: 1px 1px 1px black; background: rgba(0,0,0,0.2); border-radius: 3px; padding: 1px;}

        /* --- PENCERELER --- */
        .window {
            position: absolute;
            box-shadow: 4px 4px 0px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            min-width: 200px; min-height: 150px;
            animation: popIn 0.2s ease-out;
        }
        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        
        .title-bar {
            background: linear-gradient(90deg, var(--win-blue), #1084d0); color: white;
            padding: 3px 4px; font-weight: bold; font-size: 12px;
            display: flex; justify-content: space-between; align-items: center;
            cursor: default;
            user-select: none;
        }
        .title-bar.inactive { background: var(--win-dark-gray); }

        .title-bar-controls button {
            width: 16px; height: 14px; font-size: 9px; line-height: 10px;
            background: var(--win-gray); border: 1px outset #fff; cursor: pointer;
            font-weight: bold; margin-left: 2px; padding: 0;
        }
        .title-bar-controls button:active { border-style: inset; }

        .window-content {
            flex: 1; padding: 2px; overflow: hidden;
            display: flex; flex-direction: column;
            background: var(--win-gray);
            position: relative;
        }

        /* --- G√ñREV √áUBUƒûU --- */
        #taskbar {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 34px;
            background: var(--win-gray); border-top: 2px solid #fff;
            display: flex; align-items: center; padding: 2px;
            z-index: 9000;
        }
        .start-btn {
            display: flex; align-items: center; gap: 5px;
            padding: 2px 5px; margin-right: 5px; height: 26px;
            font-weight: bold; font-style: italic; font-size: 13px;
            border: 2px outset #fff; background: var(--win-gray);
            cursor: pointer;
        }
        .start-btn:active, .start-btn.active { border-style: inset; background: #ddd; }
        
        /* BA≈ûLAT MEN√úS√ú */
        #start-menu {
            position: absolute; bottom: 34px; left: 2px;
            width: 200px; background: var(--win-gray);
            border: 2px outset #fff; box-shadow: 4px 4px 5px rgba(0,0,0,0.5);
            display: none; flex-direction: column; z-index: 9100;
        }
        .start-side-strip {
            background: linear-gradient(180deg, #000080, #0000FF);
            color: white; width: 25px; writing-mode: vertical-rl;
            text-align: center; font-weight: bold; padding: 10px 0;
            transform: rotate(180deg);
        }
        .start-item {
            padding: 8px 15px; cursor: pointer; display: flex; align-items: center; gap: 10px; font-size: 12px;
        }
        .start-item:hover { background: #000080; color: white; }
        .start-divider { height: 1px; background: #888; margin: 3px 0; border-bottom: 1px solid #fff; }

        .clock-area {
            margin-left: auto; border: 2px inset #dfdfdf;
            padding: 4px 10px; background: #eee; font-size: 11px; margin-right: 2px; min-width: 60px; text-align: center;
        }

        .task-item {
            max-width: 150px; min-width: 80px; padding: 3px 5px; margin-right: 3px; height: 26px;
            background: var(--win-gray); border: 2px outset #fff;
            font-size: 11px; white-space: nowrap; overflow: hidden;
            text-overflow: ellipsis; cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }
        .task-item.active { border-style: inset; background: #e0e0e0; font-weight: bold;}

        /* --- APP STƒ∞LLERƒ∞ --- */
        
        /* RetroTube Grid */
        .app-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 10px; padding: 10px; overflow-y: auto; background: white;}
        .vid-item { cursor: pointer; font-size: 11px; text-align: center; }
        .vid-item:hover img { outline: 2px solid blue; }
        .vid-item img { width: 100%; height: 80px; object-fit: cover; background: black; }
        
        /* Snake Game */
        #snakeCanvas { 
            background: #9BB825; border: 4px solid #485223;
            box-shadow: inset 2px 2px 5px rgba(0,0,0,0.2); image-rendering: pixelated;
        }

        /* Calculator */
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 3px; padding: 5px; height: 100%; }
        .calc-btn { height: 100%; font-weight: bold; border: 1px outset #fff; background: var(--win-gray); cursor: pointer; }
        .calc-btn:active { border-style: inset; }
        .calc-display { grid-column: span 4; background: white; border: 2px inset #ddd; text-align: right; padding: 5px; font-family: 'Courier New'; font-size: 20px; margin-bottom: 5px; }

        /* Paint */
        .paint-toolbar { display: flex; gap: 5px; padding: 5px; background: var(--win-gray); border-bottom: 1px solid #888; }
        .color-box { width: 20px; height: 20px; border: 2px inset #fff; cursor: pointer; }
        .color-box.active { border: 2px solid black; }

        /* Explorer */
        .file-list { display: flex; flex-direction: column; background: white; height: 100%; padding: 5px; font-size: 12px; }
        .file-item { display: flex; align-items: center; gap: 5px; padding: 2px; cursor: pointer; }
        .file-item:hover { background: #000080; color: white; }

        /* WinAmp Skin */
        .amp-main { background: #222; color: #0f0; font-family: 'Courier New'; padding: 5px; height: 100%; display: flex; flex-direction: column; }
        .amp-screen { background: #000; border: 2px inset #555; height: 60px; margin-bottom: 5px; padding: 5px; position: relative; overflow: hidden; }
        .amp-visualizer { display: flex; align-items: flex-end; height: 100%; gap: 2px; }
        .amp-bar { flex: 1; background: #0f0; opacity: 0.8; transition: height 0.1s; }
        .amp-controls { display: flex; gap: 5px; justify-content: center; margin-bottom: 5px; }
        .amp-playlist { background: #111; border: 2px inset #555; flex: 1; overflow-y: auto; color: #00ff00; font-size: 10px; padding: 2px; }
        .track-item { cursor: pointer; padding: 2px; }
        .track-item:hover { background: #003300; }
        .track-item.playing { color: #fff; background: #005500; }

        /* Terminal Style */
        .terminal-container { background: black; color: #0f0; font-family: 'Courier New', monospace; padding: 5px; height: 100%; overflow-y: auto; font-size: 12px; }
        .terminal-input { background: transparent; border: none; color: #0f0; font-family: 'Courier New', monospace; width: 80%; outline: none; }

        /* --- MAYIN TARLASI STƒ∞LLERƒ∞ (YENƒ∞) --- */
        .mine-header { background: #c0c0c0; border: 2px inset #fff; padding: 4px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
        .mine-lcd { background: black; color: red; font-family: 'Courier New', monospace; font-size: 20px; padding: 2px 5px; border: 1px inset #fff; width: 50px; text-align: center; }
        .mine-face { width: 26px; height: 26px; background: #c0c0c0; border: 2px outset #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; }
        .mine-face:active { border-style: inset; }
        .mine-grid { display: grid; background: #808080; border: 3px inset #fff; width: fit-content; margin: 0 auto; }
        .mine-cell { width: 20px; height: 20px; background: #c0c0c0; border: 2px outset #fff; text-align: center; line-height: 18px; font-size: 12px; font-weight: bold; cursor: default; }
        .mine-cell.pressed { border: 1px solid #808080; border-right: none; border-bottom: none; background: #c0c0c0; padding-top: 1px; padding-left: 1px; }
        .mine-cell.flagged { color: red; }
        
        /* Renkler */
        .c1 { color: blue; } .c2 { color: green; } .c3 { color: red; } .c4 { color: darkblue; }
        .c5 { color: darkred; } .c6 { color: teal; } .c7 { color: black; } .c8 { color: gray; }

    </style>
</head>
<body>

    <div id="crt-overlay"></div>
    <div id="shutdown-overlay"></div>

    <div id="bsod" onclick="location.reload()">
        <p>A fatal exception 0E has occurred at 0028:C0011E36 in VXD VMM(01) + 00010E36.</p>
        <p>The current application will be terminated.</p>
        <p>* Press any key to terminate the current application.</p>
        <p>* Press CTRL+ALT+DEL again to restart your computer.</p>
        <br>
        <p>Press any key to continue _</p>
    </div>

    <div id="boot-screen">
        <div>RETRO-BIOS v3.2 Ultimate Pro (C) 2025 AI Corp.</div>
        <div>Main Processor: Quantum Core 256-bit</div>
        <div>Memory Test: 256000K OK</div>
        <div>Detecting HDD Primary Master... QUANTUM FIREBALL XL</div>
        <div>Detecting Sound Card... SOUND BLASTER 16 (Enabled)</div>
        <div style="margin-top: 20px;">Booting RetroOS Ultimate... <span class="cursor">_</span></div>
    </div>

    <div id="context-menu" class="outset">
        <div class="ctx-item" onclick="os.refreshDesktop()">Yenile</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="os.openApp('settings')">√ñzellikler</div>
        <div class="ctx-item" onclick="os.changeWallpaper()">Arkaplanƒ± Deƒüi≈ütir</div>
        <div class="ctx-divider"></div>
        <div class="ctx-item" onclick="os.openApp('notepad')">Yeni Metin Belgesi</div>
    </div>

    <div id="desktop">
        
        <div id="icon-container">
            <div class="desktop-icon" style="top:20px; left:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('bilgisayarim')">
                <div class="ico-img">üíª</div>
                <span>Bilgisayarƒ±m</span>
            </div>
            <div class="desktop-icon" style="top:110px; left:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('gecekondu')">
                <div class="ico-img">üèöÔ∏è</div>
                <span>Gecekondu Sim</span>
            </div>
            <div class="desktop-icon" style="top:200px; left:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('retrotube')">
                <div class="ico-img">üì∫</div>
                <span>RetroTube</span>
            </div>
            <div class="desktop-icon" style="top:290px; left:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('notepad')">
                <div class="ico-img">üìù</div>
                <span>Not Defteri</span>
            </div>
            <div class="desktop-icon" style="top:20px; left:120px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('paint')">
                <div class="ico-img">üé®</div>
                <span>RetroPaint</span>
            </div>
            <div class="desktop-icon" style="top:110px; left:120px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('calc')">
                <div class="ico-img">üßÆ</div>
                <span>Hesap Mak.</span>
            </div>
            <div class="desktop-icon" style="top:200px; left:120px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('snake')">
                <div class="ico-img">üêç</div>
                <span>Yƒ±lan Oyunu</span>
            </div>
            <div class="desktop-icon" style="top:290px; left:120px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('winamp')">
                <div class="ico-img">‚ö°</div>
                <span>WinAmp</span>
            </div>
            <div class="desktop-icon" style="top:20px; left:220px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('minesweeper')">
                <div class="ico-img">üí£</div>
                <span>Mayƒ±n Tarlasƒ±</span>
            </div>
            
            <div class="desktop-icon" style="top:380px; left:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('browser')">
                <div class="ico-img">üåç</div>
                <span>Explorer</span>
            </div>
             <div class="desktop-icon" style="top:380px; left:120px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('terminal')">
                <div class="ico-img">üìü</div>
                <span>MS-DOS</span>
            </div>
            
            <div class="desktop-icon" style="top:370px; right:20px;" onmousedown="os.startIconDrag(event, this)" ondblclick="os.openApp('trash')">
                <div class="ico-img">üóëÔ∏è</div>
                <span>Geri D√∂n√º≈ü√ºm</span>
            </div>
        </div>

        <div id="start-menu" class="outset">
            <div style="display: flex;">
                <div class="start-side-strip">RetroOS Ultimate</div>
                <div style="flex:1; padding: 2px;">
                    <div class="start-item" onclick="os.openApp('bilgisayarim'); os.toggleStartMenu()"><span>üíª</span> Bilgisayarƒ±m</div>
                    <div class="start-item" onclick="os.openApp('retrotube'); os.toggleStartMenu()"><span>üì∫</span> RetroTube</div>
                    <div class="start-item" onclick="os.openApp('winamp'); os.toggleStartMenu()"><span>‚ö°</span> WinAmp</div>
                    <div class="start-item" onclick="os.openApp('browser'); os.toggleStartMenu()"><span>üåç</span> Explorer</div>
                    <div class="start-item" onclick="os.openApp('terminal'); os.toggleStartMenu()"><span>üìü</span> MS-DOS ƒ∞stemi</div>
                    <div class="start-divider"></div>
                    <div class="start-item" onclick="os.openApp('paint'); os.toggleStartMenu()"><span>üé®</span> Paint</div>
                    <div class="start-item" onclick="os.openApp('notepad'); os.toggleStartMenu()"><span>üìù</span> Not Defteri</div>
                    <div class="start-item" onclick="os.openApp('calc'); os.toggleStartMenu()"><span>üßÆ</span> Hesap Makinesi</div>
                    <div class="start-item" onclick="os.openApp('gecekondu'); os.toggleStartMenu()"><span>üèöÔ∏è</span> Gecekondu Sim</div>
                    <div class="start-item" onclick="os.openApp('snake'); os.toggleStartMenu()"><span>üêç</span> Yƒ±lan Oyunu</div>
                    <div class="start-item" onclick="os.openApp('minesweeper'); os.toggleStartMenu()"><span>üí£</span> Mayƒ±n Tarlasƒ±</div>
                    <div class="start-divider"></div>
                    <div class="start-item" onclick="os.openApp('settings'); os.toggleStartMenu()"><span>‚öôÔ∏è</span> Ayarlar</div>
                    <div class="start-item" onclick="os.shutdown()"><span>üõë</span> Bilgisayarƒ± Kapat...</div>
                </div>
            </div>
        </div>

        <div id="taskbar">
            <button class="start-btn" id="start-btn" onclick="os.toggleStartMenu()">
                <img src="https://win98icons.alexmeub.com/icons/png/windows-0.png" width="16" style="margin-right:2px;"> Ba≈ülat
            </button>
            <div style="width: 2px; border-left: 1px solid #888; border-right: 1px solid #fff; height: 20px; margin: 0 5px;"></div>
            <div id="task-list" style="display:flex; flex:1; overflow:hidden;"></div>
            <div class="clock-area" id="clock">12:00</div>
        </div>
    </div>

<script>
    // --- GECEKONDU OYUNU KAYNAK KODU ---
    const GECEKONDU_SOURCE_CODE = `
    <!DOCTYPE html>
    <html lang="tr">
    <head>
    <style>
        html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background-color: #000; font-family: 'Courier New', monospace; user-select: none; }
        #night-sky { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 30%, #1a1a1a 0%, #000000 100%); z-index: -10; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle 3s infinite ease-in-out; z-index: -5; box-shadow: 0 0 4px white; }
        @keyframes twinkle { 0%, 100% { opacity: 0.3; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }
        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; color: white; border: 2px solid #333; }
        #start-btn { padding: 20px 40px; font-size: 24px; background: #2e7d32; color: white; border: none; cursor: pointer; border-radius: 5px; box-shadow: 0 0 15px #2e7d32; text-transform: uppercase; font-weight: bold; margin-top: 20px; }
        .info-box { position: absolute; top: 10px; left: 10px; color: #fff; background: rgba(50, 50, 50, 0.9); padding: 10px; border-radius: 5px; z-index: 1000; font-size: 14px; border: 1px solid #777; }
        .key { background: #000; color: #fff; padding: 2px 6px; border-radius: 3px; border: 1px solid #fff; font-weight: bold;}
        .skyline { position: absolute; bottom: 120px; left: 0; width: 100%; height: 60%; display: flex; justify-content: center; align-items: flex-end; gap: 2px; z-index: 1; opacity: 0.4; pointer-events: none; }
        .building { width: 10%; background: #0d0d0d; position: relative; border-top: 1px solid #333; }
        .window { width: 4px; height: 6px; background: #ffeb3b; position: absolute; box-shadow: 0 0 5px #ffeb3b; opacity: 0.6; }
        .ground { position: absolute; bottom: 0; width: 100%; height: 120px; background: #111; border-top: 4px solid #444; z-index: 2; }
        .shanty-house { position: absolute; bottom: 120px; left: 100px; width: 200px; height: 130px; background: repeating-linear-gradient(90deg, #3e2723, #3e2723 20px, #271c19 22px); z-index: 3; border: 2px solid #000; }
        .shanty-roof { position: absolute; top: -25px; left: -15px; width: 230px; height: 45px; background: #263238; transform: rotate(-2deg); border-bottom: 3px solid #000; }
        .shanty-door { position: absolute; bottom: 0; right: 30px; width: 50px; height: 85px; background: #4e342e; border: 2px solid #111; border-bottom: none; }
        .shanty-window { position: absolute; top: 30px; left: 20px; width: 40px; height: 40px; background: #000; border: 2px solid #333; overflow: hidden; }
        .shanty-window::before { content: ''; position: absolute; width: 100%; height: 100%; background: rgba(255, 235, 59, 0.2); }
        .shanty-chimney { position: absolute; top: -50px; left: 140px; width: 20px; height: 60px; background: #333; z-index: 2; }
        #car { position: absolute; bottom: 115px; left: 450px; width: 240px; height: 60px; z-index: 4; }
        .car-body { width: 100%; height: 100%; background: #607d8b; border-radius: 10px 50px 5px 5px; position: relative; border: 1px solid #fff; }
        .car-top { position: absolute; top: -35px; left: 40px; width: 130px; height: 35px; background: #607d8b; border-radius: 20px 20px 0 0; transform: skewX(-15deg); z-index: 1; border-top: 1px solid #fff; }
        .car-window-area { position: absolute; top: 5px; left: 10px; width: 110px; height: 25px; background: #222; overflow: hidden; display: flex; justify-content: center; align-items: flex-end; }
        .wheel { width: 42px; height: 42px; background: #111; border: 3px solid #777; border-radius: 50%; position: absolute; bottom: -20px; z-index: 5; display: flex; justify-content: center; align-items: center; }
        .wheel::after { content:''; width: 35px; height: 2px; background: #aaa; }
        .w1 { left: 35px; } .w2 { right: 35px; }
        .spinning { animation: spin 0.2s linear infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .headlight-beam { position: absolute; right: -300px; top: 15px; width: 300px; height: 80px; background: linear-gradient(90deg, rgba(255,255,200,0.5) 0%, transparent 100%); clip-path: polygon(0 40%, 100% 0, 100% 100%, 0 60%); display: none; z-index: 6; }
        #player { position: absolute; bottom: 115px; left: 250px; width: 50px; height: 90px; z-index: 20; display: flex; flex-direction: column; align-items: center; }
        .head-img { width: 50px; height: 45px; border-radius: 50%; background: transparent; object-fit: cover; z-index: 22; }
        .p-body { width: 30px; height: 40px; background: #455a64; border-radius: 5px; position: relative; z-index: 21; border: 1px solid #fff; }
        .p-legs { display: flex; gap: 5px; height: 30px; z-index: 20;}
        .p-leg { width: 10px; height: 100%; background: #222; border: 1px solid #555; }
        .crouch .head-img { transform: translateY(15px) rotate(5deg); }
        .crouch .p-body { height: 25px; margin-top: 10px; }
        .hidden-body { display: none !important; }
        .poop-pile { position: absolute; bottom: 125px; width: 25px; height: 20px; background: #8d6e63; border-radius: 50% 50% 5px 5px; z-index: 50; border: 2px solid #ffcc80; box-shadow: 0 0 10px #ffcc80; }
        .poop-steam { position: absolute; width: 5px; height: 20px; background: rgba(255,255,255,0.3); left: 8px; top: -15px; filter: blur(3px); animation: steam 2s infinite; }
        @keyframes steam { 0% { opacity: 0; transform: translateY(0); } 50% { opacity: 1; } 100% { opacity: 0; transform: translateY(-10px); } }
        .squashed { transform: scaleY(0.2) scaleX(2.5); opacity: 0.8; background: #5d4037; box-shadow: none; border: none; }
        .gas-cloud { position: absolute; width: 60px; height: 60px; background: rgba(50, 255, 50, 0.4); border-radius: 50%; filter: blur(20px); animation: fadeUp 2s forwards; z-index: 30; }
        @keyframes fadeUp { to { transform: translateY(-100px) scale(2); opacity: 0; } }
        .lights-out .window { background: #000 !important; box-shadow: none !important; }
        #inside-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.95); z-index: 9000; display: none; flex-direction: column; align-items: center; justify-content: center; }
        .inside-char { width: 200px; height: auto; border: 2px solid #555; border-radius: 10px; }
        .inside-text { color: #ffcc80; font-size: 22px; margin-top: 20px; text-align: center; }
        #score-board { position:absolute; top: 10px; right: 10px; color: yellow; font-size: 18px; z-index:1001; }
    </style>
    </head>
    <body>
    <div id="night-sky"><div id="stars-container"></div></div>
    <div id="start-screen"><h1 style="text-shadow: 0 0 10px white;">GECEKONDU Sƒ∞M√úLAT√ñR√ú</h1><button id="start-btn">OYUNU BA≈ûLAT</button></div>
    <div class="info-box"><span class="key">Oklar</span> Y√ºr√º <span class="key">E</span> Etkile≈üim <span class="key">X</span> Sƒ±√ß <span class="key">F</span> Osur</div>
    <div id="score-board">Sokak Saygƒ±sƒ±: 0</div>
    <div class="skyline" id="skyline"></div><div class="ground"></div>
    <div class="shanty-house"><div class="shanty-chimney"></div><div class="shanty-roof"></div><div class="shanty-window"></div><div class="shanty-door"></div></div>
    <div id="car"><div class="car-top"><div class="car-window-area" id="driver-seat"></div></div><div class="car-body"><div class="headlight-beam" id="beam"></div></div><div class="wheel w1" id="w1"></div><div class="wheel w2" id="w2"></div></div>
    <div id="player"><img src="https://i.hizliresim.com/85depzx.png" onerror="this.src='https://api.dicebear.com/7.x/avataaars/svg?seed=Felix'" class="head-img" id="player-head"><div class="p-body" id="p-body"></div><div class="p-legs" id="p-legs"><div class="p-leg"></div><div class="p-leg"></div></div></div>
    <div id="inside-screen"><img src="https://i.hizliresim.com/5q485xn.png" class="inside-char"><div class="inside-text">Evim g√ºzel evim...<br><span style="font-size: 16px; color: #888;">(√áƒ±kmak i√ßin E'ye bas)</span></div></div>
    <script>
        const DEFAULT_HEAD_URL = "https://i.hizliresim.com/85depzx.png"; const POOPING_HEAD_URL = "https://i.hizliresim.com/ov9uik2.png"; const DRIVING_HEAD_URL = "https://i.hizliresim.com/5q485xn.png";
        const starsContainer = document.getElementById('stars-container');
        for(let i=0; i<150; i++){ let s = document.createElement('div'); s.className = 'star'; let size = Math.random()*3; s.style.width = size + 'px'; s.style.height = size + 'px'; s.style.top = Math.random()*80 + '%'; s.style.left = Math.random()*100 + '%'; s.style.animationDelay = Math.random()*5 + 's'; starsContainer.appendChild(s); }
        const skyline = document.getElementById('skyline'); const buildings = [];
        for(let i=0; i<20; i++){ let d = document.createElement('div'); d.className = 'building'; d.style.height = Math.random()*50+30+'%'; for(let j=0; j<8; j++){ let w = document.createElement('div'); w.className='window'; w.style.top=Math.random()*90+'%'; w.style.left=Math.random()*70+'%'; if(Math.random()>0.7) d.appendChild(w); } skyline.appendChild(d); buildings.push(d); }
        const player = document.getElementById('player'); const pHead = document.getElementById('player-head'); const car = document.getElementById('car'); const beam = document.getElementById('beam'); const insideScreen = document.getElementById('inside-screen'); const startBtn = document.getElementById('start-btn'); const startScreen = document.getElementById('start-screen'); const scoreBoard = document.getElementById('score-board');
        let px = 350, py = 0, vy = 0; let cx = 600; let driving = false, crouching = false, jumping = false, insideHouse = false; let gameActive = false; let audioCtx; let poops = []; const keys = {}; let score = 0;
        startBtn.addEventListener('click', () => { startScreen.style.display = 'none'; gameActive = true; try { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); audioCtx.resume(); } catch(e) {} });
        function playSound(type) { if(!audioCtx) return; const osc = audioCtx.createOscillator(); const gainNode = audioCtx.createGain(); osc.connect(gainNode); gainNode.connect(audioCtx.destination); if (type === 'fart') { osc.type = 'sawtooth'; osc.frequency.setValueAtTime(150, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(40, audioCtx.currentTime + 0.5); gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5); osc.start(); osc.stop(audioCtx.currentTime + 0.5); } else if (type === 'poop') { osc.type = 'triangle'; osc.frequency.setValueAtTime(200, audioCtx.currentTime); osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.1); gainNode.gain.setValueAtTime(0.5, audioCtx.currentTime); gainNode.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.15); osc.start(); osc.stop(audioCtx.currentTime + 0.15); } }
        window.addEventListener('keydown', e => { if(!gameActive || e.repeat) return; keys[e.key] = true; if(insideHouse) { if(e.key.toLowerCase() === 'e') toggleHouse(); return; } if(!driving) { if(e.key === 'ArrowUp' && !jumping) { vy = 12; jumping = true; } if(e.key.toLowerCase() === 'x') { crouching = true; player.classList.add('crouch'); pHead.src = POOPING_HEAD_URL; doPoop(); } if(e.key.toLowerCase() === 'f') doFart(); if(e.key.toLowerCase() === 'e') checkInteraction(); } else { if(e.key.toLowerCase() === 'e') toggleCar(); } });
        window.addEventListener('keyup', e => { keys[e.key] = false; if(e.key.toLowerCase() === 'x') { crouching = false; player.classList.remove('crouch'); pHead.src = DEFAULT_HEAD_URL; } });
        function checkInteraction() { if(Math.abs(px - cx - 100) < 120) toggleCar(); else if(px > 100 && px < 300) toggleHouse(); }
        function toggleHouse() { insideHouse = !insideHouse; insideScreen.style.display = insideHouse ? 'flex' : 'none'; }
        function toggleCar() { driving = !driving; if(driving) { document.getElementById('p-body').classList.add('hidden-body'); document.getElementById('p-legs').classList.add('hidden-body'); pHead.src = DRIVING_HEAD_URL; document.getElementById('driver-seat').appendChild(pHead); beam.style.display = 'block'; player.style.display = 'none'; } else { document.getElementById('p-body').classList.remove('hidden-body'); document.getElementById('p-legs').classList.remove('hidden-body'); pHead.src = DEFAULT_HEAD_URL; player.prepend(pHead); beam.style.display = 'none'; player.style.display = 'flex'; px = cx + 80; py = 0; vy = 0; player.style.left = px + 'px'; } }
        function doFart() { playSound('fart'); const g = document.createElement('div'); g.className='gas-cloud'; g.style.left = px + 'px'; g.style.bottom = (140+py)+'px'; document.body.appendChild(g); setTimeout(()=>g.remove(), 2000); document.getElementById('night-sky').style.opacity = '1'; buildings.forEach(b => b.classList.add('lights-out')); setTimeout(() => buildings.forEach(b => b.classList.remove('lights-out')), 500); score += 5; updateScore(); }
        function doPoop() { playSound('poop'); const p = document.createElement('div'); p.className = 'poop-pile'; const s = document.createElement('div'); s.className = 'poop-steam'; p.appendChild(s); let poopX = px + 12; p.style.left = poopX + 'px'; document.body.appendChild(p); poops.push({el:p, x:poopX, squashed:false}); if(poops.length > 20) poops.shift().el.remove(); score += 10; updateScore(); }
        function updateScore() { scoreBoard.innerText = "Sokak Saygƒ±sƒ±: " + score; }
        function loop() { if(!gameActive) { requestAnimationFrame(loop); return; } if(!insideHouse) { if(!driving) { if(keys['ArrowRight']) { px += 4; player.style.transform = 'scaleX(1)'; } if(keys['ArrowLeft']) { px -= 4; player.style.transform = 'scaleX(-1)'; } py += vy; if(py > 0) vy -= 0.6; else { py = 0; vy = 0; jumping = false; } if(px < 0) px = 0; if(px > window.innerWidth - 50) px = window.innerWidth - 50; player.style.left = px + 'px'; player.style.bottom = (115 + py) + 'px'; } else { let move = 0; if(keys['ArrowRight']) { cx += 8; move=1; car.style.transform = 'scaleX(1)'; } if(keys['ArrowLeft']) { cx -= 8; move=-1; car.style.transform = 'scaleX(-1)'; } if(move !== 0) { document.querySelectorAll('.wheel').forEach(w=>w.classList.add('spinning')); } else { document.querySelectorAll('.wheel').forEach(w=>w.classList.remove('spinning')); } if(cx < -150) cx = -150; if(cx > window.innerWidth - 100) cx = window.innerWidth - 100; car.style.left = cx + 'px'; poops.forEach(obj => { if(!obj.squashed && obj.x > cx+40 && obj.x < cx+200) { obj.el.classList.add('squashed'); obj.squashed = true; score += 50; updateScore(); } }); } } requestAnimationFrame(loop); } loop();
    <\/script>
    </body>
    </html>
    `;

    // --- Vƒ∞DEO VE M√úZƒ∞K VERƒ∞TABANI ---
   const videos = [
    // --- MEVCUT Lƒ∞STENƒ∞Z ---
    { id: 'kXYiU_JCYtU', title: 'Linkin Park - Numb' },
    { id: 'pXRviuL6vMY', title: 'Twenty One Pilots - Stressed Out' },
    { id: '8UVNT4wvIGY', title: 'Gotye - Somebody That I Used To Know' },
    { id: 'RgKAFK5djSk', title: 'Wiz Khalifa - See You Again' },
    { id: 'JGwWNGJdvx8', title: 'Ed Sheeran - Shape of You' },
    { id: 'CevxZvSJLk8', title: 'Katy Perry - Roar' },
    { id: '09R8_2nJtjg', title: 'Maroon 5 - Sugar' },
    { id: 'hT_nvWreIhg', title: 'OneRepublic - Counting Stars' },
    { id: 'IcrbM1l_BoI', title: 'Avicii - Wake Me Up' },
    { id: 'y6120QOlsfU', title: 'Darude - Sandstorm' },
    { id: 'kffacxfA7G4', title: 'Justin Bieber - Baby' },
    { id: '-Bz0WcqioBc', title: 'Crazy Frog - Axel F' },

    // --- EKLENEN DEV Lƒ∞STE ---

    // 1. ƒ∞NTERNET EFSANELERƒ∞ & MEME'LER
    { id: 'dQw4w9WgXcQ', title: 'Rick Astley - Never Gonna Give You Up' },
    { id: '9bZkp7q19f0', title: 'PSY - Gangnam Style' },
    { id: 'jofNR_WkoCE', title: 'Ylvis - The Fox (What Does The Fox Say?)' },
    { id: 'QH2-TGUlwu4', title: 'Nyan Cat' },
    { id: 'sCNrK-n68CM', title: 'Trololo Song (Eduard Khil)' },
    { id: 'ZZ5LpwO-An4', title: 'He-Man - HEYYEYAAEYAAAEYAEYAA' },
    { id: 'KF32DRg9opA', title: 'Daler Mehndi - Tunak Tunak Tun' },

    // 2. ROCK & METAL KLASƒ∞KLERƒ∞
    { id: 'hTWKbfoikeg', title: 'Nirvana - Smells Like Teen Spirit' },
    { id: 'fJ9rUzIMcZQ', title: 'Queen - Bohemian Rhapsody' },
    { id: 'vx2u5uUu3DE', title: 'Bon Jovi - It\'s My Life' },
    { id: '3YxaaGgTQYM', title: 'Evanescence - Bring Me To Life' },
    { id: '1w7OgIMMRc4', title: 'Guns N\' Roses - Sweet Child O\' Mine' },
    { id: 'CSvFpBOe8eY', title: 'System Of A Down - Chop Suey!' },
    { id: 'v2AC41dglnM', title: 'AC/DC - Thunderstruck' },
    { id: 'k-CovZs-VqA', title: 'Metallica - Nothing Else Matters' },

    // 3. 2000'ler & 2010'lar POP Hƒ∞TLERƒ∞
    { id: 'qrO4YZeyl0I', title: 'Lady Gaga - Bad Romance' },
    { id: 'pRpeEdMmmQ0', title: 'Shakira - Waka Waka (This Time for Africa)' },
    { id: '2Vv-BfVoq4g', title: 'Ed Sheeran - Perfect' },
    { id: 'lp-EO5I60KA', title: 'Ed Sheeran - Thinking Out Loud' },
    { id: 'nfWlot6h_JM', title: 'Taylor Swift - Shake It Off' },
    { id: 'kJQP7kiw5Fk', title: 'Luis Fonsi - Despacito ft. Daddy Yankee' },
    { id: 'YQHsXMglC9A', title: 'Adele - Hello' },
    { id: 'rYEDA3JcQqw', title: 'Adele - Rolling in the Deep' },
    { id: 'OPf0YbXqDm0', title: 'Mark Ronson - Uptown Funk ft. Bruno Mars' },
    { id: 'fRh_vgS2dFE', title: 'Justin Bieber - Sorry' },
    { id: 'y83x7MgzWOA', title: 'Pharrell Williams - Happy' },
    { id: 'fLexgOxsZu0', title: 'Bruno Mars - The Lazy Song' },
    { id: 'RubBzkZzpUA', title: 'Katy Perry - Dark Horse' },
    { id: 'pvP_OwVSFQQ', title: 'Fifth Harmony - Worth It' },

    // 4. RAP & HIP-HOP
    { id: 'uelHwf8o7_U', title: 'Eminem - Love The Way You Lie ft. Rihanna' },
    { id: 'XbGs_qK2PQA', title: 'Eminem - Rap God' },
    { id: '_Yhyp-_hX2s', title: 'Eminem - Lose Yourself' },
    { id: '5qm8PH4xAss', title: '50 Cent - In Da Club' },
    { id: 'fPO76Jlnz6c', title: 'Coolio - Gangsta\'s Paradise' },
    { id: 'L_jWHffIx5E', title: 'Smash Mouth - All Star' },
    { id: '0KSOMA3QBU0', title: 'Katy Perry - Dark Horse ft. Juicy J' },

    // 5. ELEKTRONƒ∞K, DANCE & OYUNCU FAVORƒ∞LERƒ∞
    { id: '60ItHLz5WEA', title: 'Alan Walker - Faded' },
    { id: 'ALZHF5UqnU4', title: 'Marshmello - Alone' },
    { id: 'gCYcHz2k5x0', title: 'Martin Garrix - Animals' },
    { id: 'YQEWpTEPd5I', title: 'Skrillex - Bangarang' },
    { id: '2zNSgSzhBfM', title: 'Macklemore & Ryan Lewis - Can\'t Hold Us' },
    { id: 'ktvTqknDobU', title: 'Imagine Dragons - Radioactive' },
    { id: '7wtfhZwyrcc', title: 'Imagine Dragons - Believer' },
    { id: 'PIh2xe4jnpk', title: 'Magic! - Rude' },
    
    // 6. NOSTALJƒ∞K EFSANELER (80'ler - 90'lar)
    { id: 'djV11Xbc914', title: 'a-ha - Take On Me' },
    { id: 'sOnqjkJTMaA', title: 'Michael Jackson - Thriller' },
    { id: 'Zi_XLOBDo_Y', title: 'Michael Jackson - Billie Jean' },
    { id: 'eAM2-hg7iKg', title: 'Barbie Girl - Aqua' },
    { id: 'rog8ou-ZepE', title: 'Vanilla Ice - Ice Ice Baby' },
    { id: 'XfR9iY5y94s', title: 'Men At Work - Down Under' }
];
    
    const tracks = [
        { title: "Mustafa Sandal - Aya Benzer", duration: "3:56" },
        { title: "Sandstorm - Darude", duration: "3:45" },
        { title: "Tarkan - ≈ûƒ±marƒ±k", duration: "3:10" },
        { title: "Bomfunk MC's - Freestyler", duration: "5:06" },
        { title: "Mirkelam - Her Gece", duration: "4:02" }
    ];

    // --- SNAKE GAME ENGINE ---
    class SnakeGame {
        constructor() {
            this.canvas = null; this.ctx = null; this.interval = null;
            this.gridSize = 15; this.tileCount = 20;
            this.snake = []; this.food = {}; this.dx = 0; this.dy = 0;
            this.score = 0; this.highScore = localStorage.getItem('snake_highscore') || 0;
            this.isRunning = false; this.isGameOver = false;
            this.handleKey = this.handleKey.bind(this);
        }

        init() {
            this.canvas = document.getElementById('snakeCanvas');
            if(!this.canvas) return;
            this.ctx = this.canvas.getContext('2d');
            this.tileCount = this.canvas.width / this.gridSize;
            this.reset(); this.draw();
            document.addEventListener('keydown', this.handleKey);
        }

        reset() {
            this.snake = [{x: 10, y: 10}, {x:9, y:10}, {x:8, y:10}];
            this.score = 0; this.dx = 1; this.dy = 0;
            this.isRunning = false; this.isGameOver = false;
            this.placeFood();
        }

        destroy() {
            if (this.interval) clearInterval(this.interval);
            document.removeEventListener('keydown', this.handleKey);
        }

        placeFood() {
            this.food = { x: Math.floor(Math.random() * this.tileCount), y: Math.floor(Math.random() * this.tileCount) };
        }

        handleKey(e) {
            const win = document.getElementById('win-snake');
            if(!win || win.style.display === 'none') return;
            if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) e.preventDefault();
            
            if(!this.isRunning && !this.isGameOver) {
                this.isRunning = true; this.interval = setInterval(() => this.loop(), 80);
            }
            if(this.isGameOver && e.key.toLowerCase() === 'r') {
                this.reset(); this.draw(); return;
            }
            switch(e.key) {
                case 'ArrowUp': if(this.dy !== 1) { this.dx=0; this.dy=-1; } break;
                case 'ArrowDown': if(this.dy !== -1) { this.dx=0; this.dy=1; } break;
                case 'ArrowLeft': if(this.dx !== 1) { this.dx=-1; this.dy=0; } break;
                case 'ArrowRight': if(this.dx !== -1) { this.dx=1; this.dy=0; } break;
            }
        }

        loop() {
            const head = { x: this.snake[0].x + this.dx, y: this.snake[0].y + this.dy };
            if(head.x < 0) head.x = this.tileCount - 1; if(head.x >= this.tileCount) head.x = 0;
            if(head.y < 0) head.y = this.tileCount - 1; if(head.y >= this.tileCount) head.y = 0;
            for(let i = 0; i < this.snake.length; i++) { if(head.x === this.snake[i].x && head.y === this.snake[i].y) { this.gameOver(); return; } }
            this.snake.unshift(head);
            if(head.x === this.food.x && head.y === this.food.y) { 
                this.score += 10; 
                this.placeFood(); 
            } else { this.snake.pop(); }
            this.draw();
        }

        gameOver() { 
            this.isRunning = false; this.isGameOver = true; 
            if(this.score > this.highScore) {
                this.highScore = this.score;
                localStorage.setItem('snake_highscore', this.highScore);
            }
            clearInterval(this.interval); 
            this.draw(); 
        }

        draw() {
            this.ctx.fillStyle = '#9BB825'; this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
            this.ctx.fillStyle = '#485223';
            let fx = this.food.x * this.gridSize + this.gridSize/2;
            let fy = this.food.y * this.gridSize + this.gridSize/2;
            this.ctx.beginPath(); this.ctx.arc(fx, fy, this.gridSize/2 - 2, 0, Math.PI*2); this.ctx.fill();
            for(let part of this.snake) { this.ctx.fillStyle = 'black'; this.ctx.fillRect(part.x * this.gridSize, part.y * this.gridSize, this.gridSize - 1, this.gridSize - 1); }
            this.ctx.fillStyle = 'black'; this.ctx.font = '14px Courier New'; this.ctx.fillText("SKOR: " + this.score, 5, 15);
            this.ctx.fillText("EN ƒ∞Yƒ∞: " + this.highScore, 180, 15);
            if(!this.isRunning && !this.isGameOver) { this.ctx.fillText("BA≈ûLA: Y√∂n Tu≈üu", 90, 145); }
            if(this.isGameOver) { this.ctx.fillText("OYUN Bƒ∞TTƒ∞", 110, 140); this.ctx.fillText("'R' = Tekrar", 100, 160); }
        }
    }


    // --- ƒ∞≈ûLETƒ∞M Sƒ∞STEMƒ∞ √áEKƒ∞RDEƒûƒ∞ ---
    class OperatingSystem {
        constructor() {
            this.zIndex = 100;
            this.windows = {};
            this.snakeInstance = null;
            
            // Paint Deƒüi≈ükenleri
            this.paintCtx = null;
            this.isPainting = false;
            this.paintColor = 'black';

            // WinAmp Deƒüi≈ükenleri
            this.ampInterval = null;

            // Ses Sistemi
            this.audioCtx = null;

            // Mayƒ±n Tarlasƒ±
            this.mineState = null;

            // ƒ∞kon S√ºr√ºkleme
            this.iconDrag = null;
            
            this.initBoot();
            this.startClock();
            this.initContextMenu();
        }

        // --- SES EFEKTLERƒ∞ (YENƒ∞) ---
        initAudio() {
            if(!this.audioCtx) {
                this.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            if(this.audioCtx.state === 'suspended') {
                this.audioCtx.resume();
            }
        }

        playSystemSound(type) {
            this.initAudio();
            const osc = this.audioCtx.createOscillator();
            const gainNode = this.audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(this.audioCtx.destination);

            const now = this.audioCtx.currentTime;

            if (type === 'click') {
                // Kƒ±sa Tƒ±k Sesi
                osc.type = 'sine';
                osc.frequency.setValueAtTime(800, now);
                osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);
                gainNode.gain.setValueAtTime(0.1, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start(now);
                osc.stop(now + 0.1);
            } else if (type === 'error') {
                // Windows Hata Sesi (Taklit)
                osc.type = 'sawtooth';
                osc.frequency.setValueAtTime(100, now);
                gainNode.gain.setValueAtTime(0.2, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.5);
                osc.start(now);
                osc.stop(now + 0.5);
            } else if (type === 'startup') {
                // A√ßƒ±lƒ±≈ü Akoru
                this.playNote(261.63, now, 0.5); // C4
                this.playNote(329.63, now + 0.1, 0.5); // E4
                this.playNote(392.00, now + 0.2, 1.0); // G4
            } else if (type === 'open') {
                // Pencere A√ßƒ±lƒ±≈ü
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(600, now + 0.2);
                gainNode.gain.setValueAtTime(0.05, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.start(now);
                osc.stop(now + 0.2);
            }
        }

        playNote(freq, time, dur) {
            const o = this.audioCtx.createOscillator();
            const g = this.audioCtx.createGain();
            o.connect(g);
            g.connect(this.audioCtx.destination);
            o.type = 'sine';
            o.frequency.value = freq;
            g.gain.setValueAtTime(0.1, time);
            g.gain.exponentialRampToValueAtTime(0.001, time + dur);
            o.start(time);
            o.stop(time + dur);
        }

        initBoot() {
            setTimeout(() => {
                document.getElementById('boot-screen').style.display = 'none';
                document.getElementById('desktop').style.display = 'block';
                
                // Kullanƒ±cƒ± etkile≈üimi sonrasƒ± ses √ßalmak i√ßin dinleyici
                const firstClick = () => {
                   this.playSystemSound('startup');
                   document.removeEventListener('click', firstClick);
                };
                document.addEventListener('click', firstClick);
                
                // Global Tƒ±klama Dinleyicisi
                document.addEventListener('mousedown', (e) => {
                    // Start Menu
                    if (!e.target.closest('#start-menu') && !e.target.closest('#start-btn') && !e.target.closest('.task-item')) {
                        document.getElementById('start-menu').style.display = 'none';
                        document.getElementById('start-btn').classList.remove('active');
                    }
                    // Context Menu
                    if (!e.target.closest('#context-menu')) {
                        document.getElementById('context-menu').style.display = 'none';
                    }
                });
                
                document.addEventListener('mouseup', () => { this.iconDrag = null; });
                document.addEventListener('mousemove', (e) => this.handleIconDrag(e));

            }, 3000);
        }

        initContextMenu() {
            const desktop = document.getElementById('desktop');
            const menu = document.getElementById('context-menu');
            desktop.addEventListener('contextmenu', (e) => {
                e.preventDefault();
                if(e.target.closest('.window') || e.target.closest('#taskbar') || e.target.closest('.desktop-icon')) return;
                
                menu.style.display = 'block';
                menu.style.left = e.clientX + 'px';
                menu.style.top = e.clientY + 'px';
                this.zIndex++;
                menu.style.zIndex = this.zIndex + 9999;
                this.playSystemSound('click');
            });
        }

        startClock() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            }, 1000);
        }

        toggleStartMenu() {
            const menu = document.getElementById('start-menu');
            const btn = document.getElementById('start-btn');
            this.playSystemSound('click');
            if (menu.style.display === 'flex') {
                menu.style.display = 'none';
                btn.classList.remove('active');
            } else {
                menu.style.display = 'flex';
                this.zIndex++;
                menu.style.zIndex = this.zIndex + 999;
                btn.classList.add('active');
            }
        }

        triggerBSOD() {
            this.playSystemSound('error');
            document.getElementById('bsod').style.display = 'block';
        }

        shutdown() {
            const overlay = document.getElementById('shutdown-overlay');
            document.getElementById('start-menu').style.display = 'none';
            overlay.style.opacity = '1';
            // Shutdown sesi (pitch down)
            if(this.audioCtx) {
                const o = this.audioCtx.createOscillator();
                const g = this.audioCtx.createGain();
                o.connect(g); g.connect(this.audioCtx.destination);
                o.frequency.setValueAtTime(200, this.audioCtx.currentTime);
                o.frequency.exponentialRampToValueAtTime(10, this.audioCtx.currentTime + 1);
                g.gain.setValueAtTime(0.2, this.audioCtx.currentTime);
                o.start(); o.stop(this.audioCtx.currentTime+1);
            }
            setTimeout(() => {
                overlay.innerHTML = "<div style='color:#f00; font-family:Courier'>SYSTEM HALTED</div>";
            }, 3000);
        }

        refreshDesktop() {
            const desk = document.getElementById('desktop');
            desk.style.display = 'none';
            document.getElementById('context-menu').style.display = 'none';
            setTimeout(() => desk.style.display = 'block', 100);
        }

        changeWallpaper() {
            const colors = ['#008080', '#000080', '#4682B4', '#708090', '#2F4F4F', '#004040', 'black'];
            const randomColor = colors[Math.floor(Math.random() * colors.length)];
            document.documentElement.style.setProperty('--desktop-bg', randomColor);
            document.getElementById('context-menu').style.display = 'none';
        }

        startIconDrag(e, el) {
            if(e.button !== 0) return;
            this.playSystemSound('click');
            this.iconDrag = {
                el: el,
                offX: e.clientX - el.offsetLeft,
                offY: e.clientY - el.offsetTop
            };
        }

        handleIconDrag(e) {
            if(!this.iconDrag) return;
            e.preventDefault();
            const el = this.iconDrag.el;
            const x = e.clientX - this.iconDrag.offX;
            const y = e.clientY - this.iconDrag.offY;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
        }

        openApp(appId) {
            if (this.windows[appId]) {
                this.focusWindow(appId);
                return;
            }

            this.playSystemSound('open');

            const win = document.createElement('div');
            win.className = 'window outset';
            win.id = `win-${appId}`;
            
            const offset = Object.keys(this.windows).length * 25;
            const safeLeft = Math.min(50 + offset, window.innerWidth - 300);
            const safeTop = Math.min(30 + offset, window.innerHeight - 300);
            
            win.style.left = safeLeft + 'px';
            win.style.top = safeTop + 'px';
            win.style.zIndex = ++this.zIndex;

            win.dataset.restoredWidth = ''; win.dataset.restoredHeight = '';
            win.dataset.restoredLeft = ''; win.dataset.restoredTop = '';

            let title = '', width = '400px', height = '300px', content = '';

            switch(appId) {
                case 'gecekondu':
                    title = 'Gecekondu Sim√ºlat√∂r√º 2000';
                    width = '800px'; height = '500px';
                    const blob = new Blob([GECEKONDU_SOURCE_CODE], {type: 'text/html'});
                    const url = URL.createObjectURL(blob);
                    content = `<iframe src="${url}" style="width:100%; height:100%; border:none; background:black;"></iframe>`;
                    break;
                case 'retrotube':
                    title = 'RetroTube Player';
                    width = '600px'; height = '450px';
                    content = this.getRetroTubeHTML();
                    break;
                case 'notepad':
                    title = 'Not Defteri';
                    const savedNote = localStorage.getItem('retro_note') || '';
                    content = `
                        <div style="display:flex; flex-direction:column; height:100%;">
                            <div style="background:#ddd; padding:2px; border-bottom:1px solid #999;">
                                <button class="btn-win" onclick="os.downloadNote()">Kaydet (.txt)</button>
                            </div>
                            <textarea id="notepad-area" oninput="localStorage.setItem('retro_note', this.value)" 
                            style="flex:1; resize:none; border:none; padding:5px; font-family:'Courier New'; outline:none; font-size:14px;">${savedNote}</textarea>
                        </div>`;
                    break;
                case 'settings':
                    title = 'Denetim Masasƒ±';
                    width = '300px'; height = '300px';
                    content = `
                        <div style="padding:20px; text-align:center; background:#eee; height:100%; display:flex; flex-direction:column; gap:10px;">
                            <p><strong>G√∂r√ºnt√º Ayarlarƒ±</strong></p>
                            <button onclick="document.body.classList.toggle('crt-on'); os.playSystemSound('click');" class="start-btn" style="width:100%; justify-content:center;">üì∫ CRT Efekti</button>
                            <button onclick="os.changeWallpaper()" class="start-btn" style="width:100%; justify-content:center;">üñºÔ∏è Rastgele Arkaplan</button>
                            <hr style="width:100%; border:1px inset">
                            <p><strong>Sistem</strong></p>
                            <button onclick="os.triggerBSOD()" class="start-btn" style="width:100%; justify-content:center; color:red;">üí£ √á√∂kert</button>
                            <div style="flex:1"></div>
                            <p style="font-size:10px; color:#666;">RetroOS v3.2 Ultimate</p>
                        </div>`;
                    break;
                case 'snake':
                    title = 'Yƒ±lan Oyunu';
                    width = '320px'; height = '365px';
                    content = `<div style="background:silver; height:100%; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:5px;">
                        <canvas id="snakeCanvas" width="300" height="300"></canvas>
                        <div style="font-size:11px; font-family:'Tahoma'; color:#333;">Y√∂n Tu≈ülarƒ±: Hareket | R: Yeniden</div>
                    </div>`;
                    break;
                case 'paint':
                    title = 'Piksel Boyama - Adsƒ±z';
                    width = '500px'; height = '400px';
                    content = this.getPaintHTML();
                    break;
                case 'calc':
                    title = 'Hesap Makinesi';
                    width = '250px'; height = '300px';
                    content = this.getCalcHTML();
                    break;
                case 'bilgisayarim':
                    title = 'Bilgisayarƒ±m';
                    width = '500px'; height = '350px';
                    content = this.getComputerHTML();
                    break;
                case 'winamp':
                    title = 'WinAmp';
                    width = '300px'; height = '400px';
                    content = this.getWinampHTML();
                    break;
                case 'browser':
                    title = 'Internet Explorer';
                    width = '700px'; height = '500px';
                    content = `
                    <div style="display:flex; flex-direction:column; height:100%;">
                        <div style="padding:5px; background:#ddd; border-bottom:1px solid #999; display:flex; gap:5px;">
                            <button class="btn-win">Geri</button>
                            <input type="text" value="http://www.google.com" style="flex:1;" readonly>
                            <button class="btn-win">Git</button>
                        </div>
                        <iframe src="https://www.google.com/webhp?igu=1" style="flex:1; border:none; background:white;"></iframe>
                    </div>`;
                    break;
                case 'trash':
                    title = 'Geri D√∂n√º≈ü√ºm Kutusu';
                    content = `
                    <div style="padding:20px; text-align:center; height:100%; display:flex; flex-direction:column; justify-content:center; align-items:center;">
                        <div style="font-size:40px;">üóëÔ∏è</div>
                        <p id="trash-text">Geri d√∂n√º≈ü√ºm kutusu bo≈ü.</p>
                        <button class="btn-win" onclick="os.emptyTrash()">Kutuyu Bo≈üalt</button>
                    </div>`;
                    break;
                case 'terminal':
                    title = 'MS-DOS ƒ∞stemi';
                    width = '600px'; height = '400px';
                    content = `
                    <div class="terminal-container" onclick="document.getElementById('term-in').focus()">
                        <div>RetroOS [S√ºr√ºm 3.1.2025]</div>
                        <div>(C) Telif Hakkƒ± 1985-2025 AI Corp.</div>
                        <br>
                        <div id="term-output"></div>
                        <div style="display:flex;">
                            <span>C:\\></span>
                            <input type="text" id="term-in" class="terminal-input" autocomplete="off" onkeydown="os.handleTerminal(event)">
                        </div>
                    </div>`;
                    break;
                // --- MAYIN TARLASI HTML ---
                case 'minesweeper':
                    title = 'Mayƒ±n Tarlasƒ±';
                    width = '250px'; height = '320px';
                    content = `
                    <div style="padding:5px; background:var(--win-gray); height:100%; display:flex; flex-direction:column;">
                        <div class="mine-header">
                            <div class="mine-lcd" id="mine-count">010</div>
                            <div class="mine-face" onclick="os.initMinesweeper()">üòä</div>
                            <div class="mine-lcd" id="mine-timer">000</div>
                        </div>
                        <div style="flex:1; display:flex; justify-content:center; align-items:flex-start;">
                            <div class="mine-grid" id="mine-grid"></div>
                        </div>
                    </div>
                    `;
                    break;
            }

            win.style.width = width;
            win.style.height = height;
            win.dataset.restoredWidth = width;
            win.dataset.restoredHeight = height;

            win.innerHTML = `
                <div class="title-bar" id="title-${appId}" onmousedown="os.startDrag(event, '${appId}')">
                    <div style="display:flex; align-items:center; gap:5px;">
                        <span>${title}</span>
                    </div>
                    <div class="title-bar-controls">
                        <button onclick="os.minimizeWindow('${appId}')">_</button>
                        <button onclick="os.maximizeWindow('${appId}')">‚ñ°</button>
                        <button onclick="os.closeApp('${appId}')">X</button>
                    </div>
                </div>
                <div class="window-content inset">${content}</div>
            `;

            document.getElementById('desktop').appendChild(win);
            this.windows[appId] = win;
            this.addTaskbarItem(appId, title);

            // Uygulamaya √∂zel ba≈ülatma fonksiyonlarƒ±
            if(appId === 'retrotube') this.renderRetroGrid();
            if(appId === 'snake') {
                this.snakeInstance = new SnakeGame();
                setTimeout(() => this.snakeInstance.init(), 50);
            }
            if(appId === 'paint') this.initPaint();
            if(appId === 'winamp') this.initWinamp();
            if(appId === 'terminal') setTimeout(() => document.getElementById('term-in').focus(), 100);
            if(appId === 'minesweeper') this.initMinesweeper();

            win.onmousedown = () => this.focusWindow(appId);
            this.focusWindow(appId);
        }

        closeApp(appId) {
            this.playSystemSound('click');
            const win = document.getElementById(`win-${appId}`);
            if(win) win.remove();
            delete this.windows[appId];
            
            const task = document.getElementById(`task-${appId}`);
            if(task) task.remove();

            if(appId === 'snake' && this.snakeInstance) {
                this.snakeInstance.destroy();
                this.snakeInstance = null;
            }
            if(appId === 'winamp' && this.ampInterval) {
                clearInterval(this.ampInterval);
            }
            if(appId === 'minesweeper' && this.mineState) {
                clearInterval(this.mineState.timerInterval);
            }
        }

        focusWindow(appId) {
            document.querySelectorAll('.title-bar').forEach(el => el.classList.add('inactive'));
            const win = document.getElementById(`win-${appId}`);
            if(win) {
                win.style.zIndex = ++this.zIndex;
                win.style.display = 'flex';
                const titleBar = win.querySelector('.title-bar');
                if(titleBar) titleBar.classList.remove('inactive');
            }
            document.querySelectorAll('.task-item').forEach(el => el.classList.remove('active'));
            const task = document.getElementById(`task-${appId}`);
            if(task) task.classList.add('active');
        }

        addTaskbarItem(appId, title) {
            const task = document.createElement('div');
            task.className = 'task-item active';
            task.id = `task-${appId}`;
            task.innerHTML = `<span>${title}</span>`;
            task.onclick = () => {
                this.playSystemSound('click');
                const win = document.getElementById(`win-${appId}`);
                if(win.style.display === 'none') {
                    this.focusWindow(appId);
                } else if (win.querySelector('.title-bar').classList.contains('inactive')) {
                    this.focusWindow(appId);
                } else {
                    this.minimizeWindow(appId);
                }
            };
            document.getElementById('task-list').appendChild(task);
        }

        minimizeWindow(appId) {
            this.playSystemSound('click');
            document.getElementById(`win-${appId}`).style.display = 'none';
            document.getElementById(`task-${appId}`).classList.remove('active');
        }
        
        maximizeWindow(appId) {
            this.playSystemSound('click');
            const win = document.getElementById(`win-${appId}`);
            if(win.style.width === '100%') {
                win.style.width = win.dataset.restoredWidth;
                win.style.height = win.dataset.restoredHeight;
                win.style.top = win.dataset.restoredTop;
                win.style.left = win.dataset.restoredLeft;
            } else {
                win.dataset.restoredWidth = win.style.width;
                win.dataset.restoredHeight = win.style.height;
                win.dataset.restoredTop = win.style.top;
                win.dataset.restoredLeft = win.style.left;
                win.style.width = '100%'; 
                win.style.height = 'calc(100% - 34px)'; 
                win.style.top = '0'; 
                win.style.left = '0';
            }
        }

        startDrag(e, appId) {
            if(e.target.tagName === 'BUTTON') return;
            e.preventDefault();
            this.focusWindow(appId);
            const win = this.windows[appId];
            if(win.style.width === '100%') return;
            let startX = e.clientX; let startY = e.clientY;
            let startLeft = win.offsetLeft; let startTop = win.offsetTop;
            
            const onMouseMove = (ev) => {
                let dx = ev.clientX - startX; let dy = ev.clientY - startY;
                win.style.left = `${startLeft + dx}px`;
                win.style.top = `${startTop + dy}px`;
            };
            const onMouseUp = () => {
                document.removeEventListener('mousemove', onMouseMove);
                document.removeEventListener('mouseup', onMouseUp);
            };
            document.addEventListener('mousemove', onMouseMove);
            document.addEventListener('mouseup', onMouseUp);
        }

        // --- MAYIN TARLASI LOGIC (YENƒ∞) ---
        initMinesweeper() {
            const gridEl = document.getElementById('mine-grid');
            if(!gridEl) return;
            
            // Ayarlar (Beginner)
            const rows = 9; const cols = 9; const mineCount = 10;
            
            gridEl.style.gridTemplateColumns = `repeat(${cols}, 20px)`;
            gridEl.innerHTML = '';
            
            // Oyun Durumu
            this.mineState = {
                rows, cols, mineCount,
                grid: [],
                gameOver: false,
                firstClick: true,
                flags: 0,
                time: 0,
                timerInterval: null
            };

            // Sayacƒ± sƒ±fƒ±rla
            document.getElementById('mine-count').innerText = mineCount.toString().padStart(3, '0');
            document.getElementById('mine-timer').innerText = "000";
            if(this.mineState.timerInterval) clearInterval(this.mineState.timerInterval);
            document.querySelector('.mine-face').innerText = 'üòä';

            // Grid olu≈ütur
            for(let r=0; r<rows; r++) {
                const rowArr = [];
                for(let c=0; c<cols; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'mine-cell';
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    
                    // Tƒ±klama olaylarƒ±
                    cell.onmousedown = (e) => {
                        if(this.mineState.gameOver) return;
                        if(e.button === 0) document.querySelector('.mine-face').innerText = 'üòÆ';
                    };
                    cell.onmouseup = (e) => {
                        if(this.mineState.gameOver) return;
                        document.querySelector('.mine-face').innerText = 'üòä';
                        if(e.button === 0) this.clickMineCell(r, c);
                    };
                    cell.oncontextmenu = (e) => {
                        e.preventDefault();
                        this.flagMineCell(r, c);
                    };
                    
                    gridEl.appendChild(cell);
                    rowArr.push({ isMine: false, revealed: false, flagged: false, count: 0, el: cell });
                }
                this.mineState.grid.push(rowArr);
            }
        }

        placeMines(excludeR, excludeC) {
            let placed = 0;
            while(placed < this.mineState.mineCount) {
                const r = Math.floor(Math.random() * this.mineState.rows);
                const c = Math.floor(Math.random() * this.mineState.cols);
                if((r !== excludeR || c !== excludeC) && !this.mineState.grid[r][c].isMine) {
                    this.mineState.grid[r][c].isMine = true;
                    placed++;
                }
            }
            // Sayƒ±larƒ± hesapla
            for(let r=0; r<this.mineState.rows; r++) {
                for(let c=0; c<this.mineState.cols; c++) {
                    if(!this.mineState.grid[r][c].isMine) {
                        let count = 0;
                        for(let i=-1; i<=1; i++) {
                            for(let j=-1; j<=1; j++) {
                                const nr = r+i, nc = c+j;
                                if(nr>=0 && nr<this.mineState.rows && nc>=0 && nc<this.mineState.cols && this.mineState.grid[nr][nc].isMine) count++;
                            }
                        }
                        this.mineState.grid[r][c].count = count;
                    }
                }
            }
        }

        clickMineCell(r, c) {
            const cell = this.mineState.grid[r][c];
            if(cell.revealed || cell.flagged || this.mineState.gameOver) return;

            if(this.mineState.firstClick) {
                this.placeMines(r, c);
                this.mineState.firstClick = false;
                this.mineState.timerInterval = setInterval(() => {
                    this.mineState.time++;
                    document.getElementById('mine-timer').innerText = Math.min(999, this.mineState.time).toString().padStart(3,'0');
                }, 1000);
            }

            if(cell.isMine) {
                // Game Over
                this.mineState.gameOver = true;
                clearInterval(this.mineState.timerInterval);
                document.querySelector('.mine-face').innerText = 'üòµ';
                cell.el.style.background = 'red';
                // T√ºm mayƒ±nlarƒ± g√∂ster
                this.mineState.grid.forEach(row => row.forEach(c => {
                    if(c.isMine) c.el.innerText = 'üí£';
                }));
                this.playSystemSound('error');
            } else {
                this.revealCell(r, c);
                this.checkMineWin();
            }
        }

        revealCell(r, c) {
            const cell = this.mineState.grid[r][c];
            if(cell.revealed || cell.flagged) return;
            
            cell.revealed = true;
            cell.el.classList.add('pressed');
            if(cell.count > 0) {
                cell.el.innerText = cell.count;
                cell.el.classList.add('c'+cell.count);
            } else {
                // Bo≈üsa etrafƒ±nƒ± a√ß
                for(let i=-1; i<=1; i++) {
                    for(let j=-1; j<=1; j++) {
                        const nr = r+i, nc = c+j;
                        if(nr>=0 && nr<this.mineState.rows && nc>=0 && nc<this.mineState.cols) {
                            this.revealCell(nr, nc);
                        }
                    }
                }
            }
        }

        flagMineCell(r, c) {
            if(this.mineState.gameOver) return;
            const cell = this.mineState.grid[r][c];
            if(cell.revealed) return;

            if(cell.flagged) {
                cell.flagged = false;
                cell.el.innerText = '';
                cell.el.classList.remove('flagged');
                this.mineState.flags--;
            } else {
                cell.flagged = true;
                cell.el.innerText = 'üö©';
                cell.el.classList.add('flagged');
                this.mineState.flags++;
            }
            document.getElementById('mine-count').innerText = (this.mineState.mineCount - this.mineState.flags).toString().padStart(3, '0');
        }

        checkMineWin() {
            let revealedCount = 0;
            this.mineState.grid.forEach(row => row.forEach(c => {
                if(c.revealed) revealedCount++;
            }));
            const totalCells = this.mineState.rows * this.mineState.cols;
            if(revealedCount === totalCells - this.mineState.mineCount) {
                this.mineState.gameOver = true;
                clearInterval(this.mineState.timerInterval);
                document.querySelector('.mine-face').innerText = 'üòé';
                this.playSystemSound('startup'); // Zafer sesi olarak startup'ƒ± kullan
            }
        }

        // --- HTML GENERATORS ---

        getRetroTubeHTML() {
            return `
                <div class="app-retro" style="display:flex; flex-direction:column; height:100%; background:white;">
                    <div class="app-header" style="padding:5px; background:#eee; border-bottom:1px solid #999; display:flex; gap:5px;">
                        <button onclick="os.renderRetroGrid()" class="btn-win">üè† Ana Sayfa</button>
                        <input type="text" id="custom-vid-input" placeholder="Video ID veya Link..." style="flex:1;">
                        <button onclick="os.playCustomVideo()" class="btn-win">Git</button>
                    </div>
                    <div id="retro-grid" class="app-grid"></div>
                    <div id="retro-player" style="display:none; height:100%; background:black; flex-direction:column;">
                        <div id="iframe-holder" style="flex:1;"></div>
                    </div>
                </div>
            `;
        }

        getCalcHTML() {
            return `
            <div style="height:100%; background:#eee; padding:5px; display:flex; flex-direction:column;">
                <input type="text" class="calc-display" id="calc-disp" readonly value="">
                <div class="calc-grid">
                    <button class="calc-btn" onclick="os.calcIn('7')">7</button><button class="calc-btn" onclick="os.calcIn('8')">8</button><button class="calc-btn" onclick="os.calcIn('9')">9</button><button class="calc-btn" onclick="os.calcIn('/')">/</button>
                    <button class="calc-btn" onclick="os.calcIn('4')">4</button><button class="calc-btn" onclick="os.calcIn('5')">5</button><button class="calc-btn" onclick="os.calcIn('6')">6</button><button class="calc-btn" onclick="os.calcIn('*')">*</button>
                    <button class="calc-btn" onclick="os.calcIn('1')">1</button><button class="calc-btn" onclick="os.calcIn('2')">2</button><button class="calc-btn" onclick="os.calcIn('3')">3</button><button class="calc-btn" onclick="os.calcIn('-')">-</button>
                    <button class="calc-btn" onclick="os.calcIn('0')">0</button><button class="calc-btn" onclick="os.calcCl()">C</button><button class="calc-btn" onclick="os.calcEq()">=</button><button class="calc-btn" onclick="os.calcIn('+')">+</button>
                </div>
            </div>`;
        }

        getPaintHTML() {
            return `
            <div style="height:100%; display:flex; flex-direction:column;">
                <div class="paint-toolbar">
                    <div class="color-box" style="background:black" onclick="os.setPaintColor(this, 'black')"></div>
                    <div class="color-box" style="background:red" onclick="os.setPaintColor(this, 'red')"></div>
                    <div class="color-box" style="background:blue" onclick="os.setPaintColor(this, 'blue')"></div>
                    <div class="color-box" style="background:green" onclick="os.setPaintColor(this, 'green')"></div>
                    <div class="color-box" style="background:yellow" onclick="os.setPaintColor(this, 'yellow')"></div>
                    <div class="color-box" style="background:white" onclick="os.setPaintColor(this, 'white')"></div>
                    <div style="flex:1"></div>
                    <button class="btn-win" onclick="os.clearPaint()">Temizle</button>
                    <button class="btn-win" onclick="os.savePaint()">Kaydet</button>
                </div>
                <div style="flex:1; background:white; cursor:crosshair; position:relative; overflow:hidden;">
                    <canvas id="paintCanvas" style="display:block;"></canvas>
                </div>
            </div>`;
        }

        getComputerHTML() {
            return `
            <div style="display:flex; height:100%;">
                <div style="width:120px; background:white; border-right:2px solid #ccc; padding:5px;">
                    <div style="margin-bottom:5px;">üìÅ Masa√ºst√º</div>
                    <div style="margin-bottom:5px; font-weight:bold; color:blue;">üíª Bilgisayarƒ±m</div>
                    <div style="margin-left:10px;">üíæ C: (Sistem)</div>
                    <div style="margin-left:10px;">üíø D: (Oyunlar)</div>
                </div>
                <div class="file-list" style="flex:1; overflow-y:auto;">
                    <div class="file-item" ondblclick="os.openApp('notepad')">üìÑ notlar.txt</div>
                    <div class="file-item" ondblclick="os.openApp('gecekondu')">üéÆ gecekondu.exe</div>
                    <div class="file-item" ondblclick="os.openApp('minesweeper')">üí£ winmine.exe</div>
                    <div class="file-item">üìÅ Windows</div>
                    <div class="file-item">üìÅ Program Files</div>
                    <div class="file-item" ondblclick="os.triggerBSOD()">‚ö†Ô∏è system32.dll</div>
                </div>
            </div>`;
        }

        getWinampHTML() {
            let list = '';
            tracks.forEach((t, i) => {
                list += `<div class="track-item" onclick="os.playTrack(${i}, this)">${i+1}. ${t.title} (${t.duration})</div>`;
            });
            return `
            <div class="amp-main">
                <div class="amp-screen">
                    <div style="font-size:10px;">WinAmp v1.0</div>
                    <div id="amp-status" style="margin:2px 0; color:white;">HAZIR</div>
                    <div class="amp-visualizer" id="amp-vis"></div>
                </div>
                <div class="amp-controls">
                    <button class="btn-win" onclick="os.ampAction('prev')">|&lt;</button>
                    <button class="btn-win" onclick="os.ampAction('play')">&gt;</button>
                    <button class="btn-win" onclick="os.ampAction('pause')">||</button>
                    <button class="btn-win" onclick="os.ampAction('stop')">[]</button>
                    <button class="btn-win" onclick="os.ampAction('next')">&gt;|</button>
                </div>
                <div class="amp-playlist" id="amp-list">${list}</div>
            </div>`;
        }

        // --- APP LOGIC ---

        // RetroTube
        renderRetroGrid() {
            const grid = document.getElementById('retro-grid');
            const player = document.getElementById('retro-player');
            const holder = document.getElementById('iframe-holder');
            if(!grid) return;
            holder.innerHTML = '';
            player.style.display = 'none';
            grid.style.display = 'grid';
            grid.innerHTML = '';
            videos.forEach(v => {
                const el = document.createElement('div');
                el.className = 'vid-item';
                el.onclick = () => this.playVideo(v.id);
                el.innerHTML = `<img src="https://img.youtube.com/vi/${v.id}/mqdefault.jpg"><div style="margin-top:2px;">${v.title}</div>`;
                grid.appendChild(el);
            });
        }

        playVideo(id) {
            const grid = document.getElementById('retro-grid');
            const player = document.getElementById('retro-player');
            const holder = document.getElementById('iframe-holder');
            grid.style.display = 'none';
            player.style.display = 'flex';
            holder.innerHTML = `<iframe src="https://www.youtube.com/embed/${id}?autoplay=1" style="width:100%; height:100%; border:none;" allow="autoplay; encrypted-media" allowfullscreen></iframe>`;
        }

        playCustomVideo() {
            const input = document.getElementById('custom-vid-input').value;
            let vidId = input;
            if(input.includes('v=')) vidId = input.split('v=')[1].split('&')[0];
            else if(input.includes('youtu.be/')) vidId = input.split('youtu.be/')[1];
            if(vidId.length > 5) this.playVideo(vidId);
            else alert("Ge√ßersiz Video ID!");
        }

        // Paint
        initPaint() {
            setTimeout(() => {
                const canvas = document.getElementById('paintCanvas');
                const container = canvas.parentElement;
                canvas.width = container.clientWidth;
                canvas.height = container.clientHeight;
                
                this.paintCtx = canvas.getContext('2d');
                this.paintCtx.lineCap = 'round';
                this.paintCtx.lineWidth = 3;
                this.paintCtx.strokeStyle = 'black';

                canvas.addEventListener('mousedown', (e) => {
                    this.isPainting = true;
                    this.paintCtx.beginPath();
                    this.paintCtx.moveTo(e.offsetX, e.offsetY);
                });
                canvas.addEventListener('mousemove', (e) => {
                    if(!this.isPainting) return;
                    this.paintCtx.lineTo(e.offsetX, e.offsetY);
                    this.paintCtx.stroke();
                });
                const stop = () => this.isPainting = false;
                canvas.addEventListener('mouseup', stop);
                canvas.addEventListener('mouseleave', stop);
            }, 100);
        }
        setPaintColor(el, color) {
            this.playSystemSound('click');
            this.paintColor = color;
            this.paintCtx.strokeStyle = color;
            this.paintCtx.lineWidth = (color === 'white') ? 10 : 3;
            document.querySelectorAll('.color-box').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
        }
        clearPaint() {
            const canvas = document.getElementById('paintCanvas');
            this.paintCtx.clearRect(0, 0, canvas.width, canvas.height);
        }
        savePaint() {
            const canvas = document.getElementById('paintCanvas');
            const link = document.createElement('a');
            link.download = 'resim.png';
            link.href = canvas.toDataURL();
            link.click();
        }

        // Calculator
        calcIn(val) { 
            this.playSystemSound('click');
            document.getElementById('calc-disp').value += val; 
        }
        calcCl() { 
            this.playSystemSound('click');
            document.getElementById('calc-disp').value = ''; 
        }
        calcEq() { 
            this.playSystemSound('click');
            try { 
                document.getElementById('calc-disp').value = eval(document.getElementById('calc-disp').value); 
            } catch(e) { document.getElementById('calc-disp').value = 'Hata'; } 
        }

        // Notepad
        downloadNote() {
            const text = document.getElementById('notepad-area').value;
            const blob = new Blob([text], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'Notum.txt';
            link.click();
        }
        
        // Trash
        emptyTrash() {
            this.playSystemSound('click');
            document.getElementById('trash-text').innerText = "Geri d√∂n√º≈ü√ºm kutusu zaten tertemiz!";
            setTimeout(() => {
                 document.getElementById('trash-text').innerText = "Geri d√∂n√º≈ü√ºm kutusu bo≈ü.";
            }, 2000);
        }

        // Terminal
        handleTerminal(e) {
            if(e.key === 'Enter') {
                const input = e.target.value.trim();
                const outputDiv = document.getElementById('term-output');
                
                outputDiv.innerHTML += `<div>C:\\> ${input}</div>`;
                
                let response = "";
                const cmd = input.toLowerCase();
                
                if(cmd === 'help') response = "KOMUTLAR: HELP, VER, DATE, CLS, DIR, ECHO, EXIT";
                else if(cmd === 'ver') response = "RetroOS Ultimate [S√ºr√ºm 3.2.2025]";
                else if(cmd === 'date') response = new Date().toString();
                else if(cmd === 'cls') { outputDiv.innerHTML = ""; e.target.value = ""; return; }
                else if(cmd === 'dir') response = " <DIR> WINDOWS<br> <DIR> PROGRAM FILES<br> gecekondu.exe<br> winmine.exe<br> notlar.txt<br> system32.dll";
                else if(cmd.startsWith('echo ')) response = input.substring(5);
                else if(cmd === 'exit') { this.closeApp('terminal'); return; }
                else if(cmd === '') response = "";
                else response = `'${input}' ge√ßerli bir komut deƒüil.`;
                
                if(response) outputDiv.innerHTML += `<div style="color:#ccc; margin-bottom:10px;">${response}</div>`;
                
                e.target.value = "";
                const container = document.querySelector('.terminal-container');
                container.scrollTop = container.scrollHeight;
            }
        }

        // WinAmp
        initWinamp() {
            const vis = document.getElementById('amp-vis');
            vis.innerHTML = '';
            for(let i=0; i<20; i++) {
                const bar = document.createElement('div');
                bar.className = 'amp-bar';
                bar.style.height = '5px';
                vis.appendChild(bar);
            }
        }
        playTrack(idx, el) {
            this.playSystemSound('click');
            document.querySelectorAll('.track-item').forEach(t => t.classList.remove('playing'));
            if(el) el.classList.add('playing');
            else document.querySelectorAll('.track-item')[idx].classList.add('playing');
            
            document.getElementById('amp-status').innerText = "√áALIYOR: " + tracks[idx].title.substring(0, 20) + "...";
            this.startAmpVisualizer();
        }
        ampAction(act) {
            this.playSystemSound('click');
            if(act === 'play') {
                this.startAmpVisualizer();
                document.getElementById('amp-status').innerText = "OYNATILIYOR...";
            } else if(act === 'stop') {
                this.stopAmpVisualizer();
                document.getElementById('amp-status').innerText = "DURDU";
            } else if(act === 'pause') {
                this.stopAmpVisualizer();
                document.getElementById('amp-status').innerText = "DURAKLATILDI";
            }
        }
        startAmpVisualizer() {
            if(this.ampInterval) clearInterval(this.ampInterval);
            this.ampInterval = setInterval(() => {
                document.querySelectorAll('.amp-bar').forEach(bar => {
                    bar.style.height = Math.random() * 40 + 5 + 'px';
                });
            }, 100);
        }
        stopAmpVisualizer() {
            if(this.ampInterval) clearInterval(this.ampInterval);
            document.querySelectorAll('.amp-bar').forEach(bar => bar.style.height = '2px');
        }
    }

    const os = new OperatingSystem();

</script>
</body>
</html>
